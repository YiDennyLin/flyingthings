apiVersion: batch/v1
kind: Job
metadata:
  name: training-job
  namespace: flyingthings-standalone
spec:
  selector: {}
  template:
    metadata:
      name: training
    spec:
      nodeSelector:
        nvidia.com/gpu.deploy.driver: 'true'  
      containers:
        - name: training
          image: image-registry.openshift-image-registry.svc:5000/flyingthings-standalone/training-job
          env:
          - name: BATCH_SIZE
            value: "-1"
          - name: NUM_EPOCHS
            value: "100"
          command:
            - /opt/app-root/src/simplevis-data/run-training.sh
          volumeMounts:
            - mountPath: /opt/app-root/src/simplevis-data/datasets
              name: training-data
            - mountPath: /opt/app-root/src/simplevis-data/runs
              name: run-data
            - mountPath: /dev/shm
              name: dshm
          resources:
            limits:
              nvidia.com/gpu: 1
      volumes:
        - name: training-data
          emptyDir: {}
        - name: run-data
          emptyDir: {}
        - name: dshm
          emptyDir:
             medium: Memory
      restartPolicy: Never
